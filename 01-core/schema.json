{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://livecontracts.io/draft-01/01-core/schema#",
  "title": "Live Contracts core schema",
  "type": "object",
  "properties": {
    "$schema": {
      "type": "string",
      "format": "uri"
    },
    "id": {
      "type": "string",
      "format": "uri"
    },
    "actors": {
      "type": "object",
      "patternProperties": {
        "^\\w+$": {
          "anyOf": [
            { "$ref": "http://json-schema.org/draft-07/schema#" },
            { "$ref": "http://json-schema.org/draft-07/schema#/definitions/schemaArray" }
          ],
        }
      }
    },
    "assets": {
      "type": "object",
      "patternProperties": {
        "^\\w+$": {
          "anyOf": [
            { "$ref": "http://json-schema.org/draft-07/schema#" },
            { "$ref": "http://json-schema.org/draft-07/schema#/definitions/schemaArray" }
          ],
        }
      }
    },
    "states": {
      "type": "object",
      "patternProperties": {
        "^\\w+$": {
          "$ref": "#state"
        }
      }
    },
    "actions": {
      "type": "object",
      "patternProperties": {
        "^\\w+$": {
          "$ref": "#action"
        }
      }
    }
  },
  "definitions": {
    "action": {
      "$id": "#action",
      "type": "object",
      "properties": {
        "$schema": {
          "type": "string",
          "format": "uri"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "actor": {
          "anyOf": [
            { "type": "string" },
            {
              "type": "array",
              "items": {
                "type": "string"
              },
              "minItems": 1,
              "uniqueItems": true
            }
          ]
        },
        "responses": {
          "type": "array",
          "items": {
            "$ref": "#response"
          }
        },
        "default_response": {
          "type": "string",
          "default": "ok"
        }
      },
      "required": [ "$schema", "actor" ],
    },
    "response": {
      "type": "object",
      "patternProperties": {
        "^\\w+$": {
          "type": "object",
          "properties": {
            "transition": {
              "type": "string",
              "pattern": "^\\w+$"
            },
            "update": {
              "$ref": "#update"
            }
          }
        }
      }
    },
    "state": {
      "$id": "#state",
      "type": "object",
      "properties": {
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "alt_descriptions": {
          "type": "object",
          "patternProperties": {
            "^\\w+$": {
              "type": "string",
            }
          }
        },
        "actions": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^\\w+$"
          }
        },
        "default_action": {
          "type": "string",
          "description": "Reference to the default action"
        },
        "transitions": {
          "type": "array",
          "items": {
            "$ref": "#transition"
          }
        },
        "timeout": {
          "type": "string",
          "pattern": "^\\d+[ymdwhis](\\s\\d+[ymdwhis])*$"
        }
      }
    },
    "transition": {
      "$id": "transition",
      "type": "object",
      "properties": {
        "action": {
          "type": "string",
          "pattern": "^\\w+$"
        },
        "response": {
          "type": "string",
          "pattern": "^\\w+$"
        },
        "condition": {
          "type": "string"
        },
        "transition": {
          "type": "string",
          "pattern": "^\\w+$"
        }
      }
    }
  }
}

